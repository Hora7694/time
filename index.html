<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Configurator - DataVault</title>
    <link rel="stylesheet" href="index.css">
    <style id="local-font-style"></style>
    <style>
        html, body { height: 100%; margin: 0; }
        body { display: flex; flex-direction: column; }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .config-container {
            display: flex;
            gap: 40px;
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
            justify-content: center;
        }
        .settings-column {
            flex: 1;
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .setting-group { display: flex; flex-direction: column; gap: 5px; }
        .setting-group label { font-weight: bold; font-size: 0.9em; }
        
        .setting-group input, .setting-group select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 14px;
        }

        .setting-group input[type="color"] {
            height: 35px;
            width: 60px;
            padding: 2px;
            cursor: pointer;
        }

        .preview-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        #preview-box {
            width: 100%;
            height: 350px;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            border: 2px solid var(--border-color);
        }
        #preview-text { font-weight: bold; white-space: nowrap; transition: all 0.2s; }
        
        .btn-copy {
            width: 100%;
            background-color: #5553ff;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
        }

        .btn-file {
            border: 1px dashed #5553ff;
            color: #5553ff;
            background-color: transparent;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 13px;
            display: inline-block;
        }

        @media (max-width: 850px) { .config-container { flex-direction: column; } }
    </style>
</head>
<body>
    <button id="theme-toggle">ðŸŒ™</button>

    <div class="main-content">
        <h1>Time Configurator</h1>

        <div class="config-container">
            <div class="settings-column">
                <h2>Text</h2>
                <div class="setting-group">
                    <label>Clock style</label>
                    <select id="clock-style">
                        <option value="1">Style 1: HH:MM:SS</option>
                        <option value="2">Style 2: HH:MM</option>
                        <option value="3">Style 3: HHhMM:SS</option>
                        <option value="4">Style 4: HHhMM</option>
                        <option value="5">Style 5: HHh</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label>Font family</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="font-select" style="flex: 1;">
                            <option value="'Segoe UI', sans-serif">Segoe UI (DÃ©faut)</option>
                            <option value="'Arial', sans-serif">Arial</option>
                            <option value="'Courier New', monospace">Courier New</option>
                            <option value="'Georgia', serif">Georgia</option>
                            <option value="'Impact', sans-serif">Impact</option>
                            <option value="'Verdana', sans-serif">Verdana</option>
                        </select>
                        <label for="font-file" class="btn-file">Import .ttf/.otf</label>
                        <input type="file" id="font-file" accept=".ttf, .otf" style="display: none;">
                    </div>
                </div>

                <div class="setting-group">
                    <label>Text size (px)</label>
                    <input type="number" id="textSize" value="180">
                </div>

                <h2>Shadow</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="setting-group"><label>Shadow X</label><input type="number" id="sh-x" value="5"></div>
                    <div class="setting-group"><label>Shadow Y</label><input type="number" id="sh-y" value="5"></div>
                    <div class="setting-group"><label>Blur (%)</label><input type="number" id="sh-blur" value="25"></div>
                    <div class="setting-group"><label>Opacity (%)</label><input type="number" id="sh-opacity" value="50"></div>
                </div>

                <h2>Color</h2>
                <div style="display: flex; gap: 15px;">
                    <div class="setting-group">
                        <label>Background</label>
                        <input type="color" id="bgColor" value="#00FF00">
                    </div>
                    <div class="setting-group">
                        <label>Font</label>
                        <input type="color" id="textColor" value="#FFFFFF">
                    </div>
                    <div class="setting-group">
                        <label>Shadow</label>
                        <input type="color" id="shadowColor" value="#000000">
                    </div>
                </div>
            </div>

            <div class="preview-column">
                <div id="preview-box">
                    <div id="preview-text">18:47:44</div>
                </div>
                <button class="btn-copy" id="copy-btn">Copier le lien pour OBS</button>
            </div>
        </div>
    </div>

    <footer style="text-align: center; padding: 40px; border-top: 1px solid #eee; font-size: 0.85em; color: #888; line-height: 1.8;">
        <p>Plateforme de donnÃ©es <strong>DataVault</strong></p>
        
        <div style="margin: 20px 0;">
            <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script>
            <script type='text/javascript'>
                kofiwidget2.init('Soutenir le projet', '#5553ff', 'T6T117BAZT');
                kofiwidget2.draw();
            </script>
        </div>

        <p>&copy; 2025 &bull; <a href="legal.html" style="color: #5553ff; text-decoration: none;">Mentions LÃ©gales & ConfidentialitÃ©</a></p>
    </footer>

    <script>
        const inputs = ['clock-style', 'font-select', 'bgColor', 'textColor', 'textSize', 'sh-x', 'sh-y', 'sh-blur', 'sh-opacity', 'shadowColor'];
        const previewText = document.getElementById('preview-text');
        const localFontStyle = document.getElementById('local-font-style');
        let currentFontName = "'Segoe UI', sans-serif";
        let customFontBase64 = "";

        document.getElementById('font-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    customFontBase64 = event.target.result;
                    const fontFace = `@font-face { font-family: 'CustomFont'; src: url('${customFontBase64}'); }`;
                    localFontStyle.innerHTML = fontFace;
                    currentFontName = 'CustomFont';
                    updatePreview();
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('font-select').addEventListener('change', function(e) {
            currentFontName = e.target.value;
            customFontBase64 = ""; // Reset si on repasse sur une police systÃ¨me
            updatePreview();
        });

        function hexToRgba(hex, opacity) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${opacity / 100})`;
        }

        function updatePreview() {
            previewText.style.fontFamily = currentFontName;
            document.getElementById('preview-box').style.backgroundColor = document.getElementById('bgColor').value;
            previewText.style.color = document.getElementById('textColor').value;
            previewText.style.fontSize = (document.getElementById('textSize').value / 3) + "px";
            
            const shadowRGBA = hexToRgba(document.getElementById('shadowColor').value, document.getElementById('sh-opacity').value);
            previewText.style.textShadow = `${document.getElementById('sh-x').value/3}px ${document.getElementById('sh-y').value/3}px ${document.getElementById('sh-blur').value/3}px ${shadowRGBA}`;

            const examples = { "1":"18:47:44", "2":"18:47", "3":"18h47:44", "4":"18h47", "5":"18h" };
            previewText.textContent = examples[document.getElementById('clock-style').value];
        }

        inputs.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.addEventListener('input', updatePreview);
        });

        document.getElementById('copy-btn').addEventListener('click', function() {
            const p = new URLSearchParams();
            p.append('color', document.getElementById('textColor').value.replace('#',''));
            p.append('bgColor', document.getElementById('bgColor').value.replace('#',''));
            p.append('size', document.getElementById('textSize').value);
            p.append('shadow', `${document.getElementById('sh-x').value}-${document.getElementById('sh-y').value}-${document.getElementById('sh-blur').value}-${document.getElementById('sh-opacity').value}`);
            p.append('shadowColor', document.getElementById('shadowColor').value.replace('#',''));
            p.append('style', document.getElementById('clock-style').value);
            
            if (customFontBase64) {
                // On compresse lÃ©gÃ¨rement la base64 pour l'URL
                p.append('fontData', customFontBase64);
            } else {
                p.append('font', currentFontName.replace(/'/g, ""));
            }

            const finalUrl = "https://hora7694.github.io/time/?" + p.toString();
            
            // Note: Le lien sera trÃ¨s long, c'est normal car il contient le fichier.
            navigator.clipboard.writeText(finalUrl);
            this.textContent = "Lien OBS copiÃ© !";
            setTimeout(() => this.textContent = "Copier le lien pour OBS", 2000);
        });

        const btn = document.getElementById('theme-toggle');
        if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
        btn.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        });

        updatePreview();
    </script>
</body>
</html>
